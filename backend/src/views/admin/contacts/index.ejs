<div class="card">
    <div class="page-header">
        <div class="header-content">
            <h3>Contact Methods</h3>
            <p>Drag items to reorder how they appear on your card</p>
        </div>
        <div class="header-actions">
            <a href="/admin/contacts/new" class="btn btn-accent">Add New Contact</a>
        </div>
    </div>

    <div id="contact-list" class="list-grid">
        <% contacts.forEach(contact=> { %>
            <div class="list-item" data-id="<%= contact.id %>">
                <div class="item-header">
                    <div class="item-icon">
                        <i data-lucide="<%= contact.icon?.toLowerCase() || 'mail' %>"></i>
                    </div>
                    <div class="item-info">
                        <div class="item-title">
                            <%= contact.label %>
                        </div>
                        <div class="item-subtitle">
                            <%= contact.type %>
                        </div>
                    </div>
                </div>

                <div class="item-content-box">
                    <div class="item-value">
                        <%= contact.value %>
                    </div>
                    <% if (contact.link) { %>
                        <div class="item-link">
                            <%= contact.link %>
                        </div>
                        <% } %>
                </div>

                <div class="item-actions">
                    <a href="/admin/contacts/<%= contact.id %>/edit" class="btn btn-primary btn-sm">Edit</a>
                    <form action="/admin/contacts/<%= contact.id %>?_method=DELETE" method="POST" style="margin: 0;"
                        onsubmit="return confirm('Remove this contact method?')">
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                </div>
            </div>
            <% }) %>
    </div>
</div>

<script src="https://unpkg.com/lucide@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
    lucide.createIcons();

    const el = document.getElementById('contact-list');
    if (el) {
        Sortable.create(el, {
            animation: 150,
            ghostClass: 'sortable-ghost',
            onEnd: function (evt) {
                const order = Array.from(el.querySelectorAll('.list-item')).map(item => item.getAttribute('data-id'));
                fetch('/admin/contacts/reorder', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ order })
                });
            }
        });
    }
</script>