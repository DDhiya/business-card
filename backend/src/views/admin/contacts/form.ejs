<div class="form-container" style="max-width: 800px; margin: 0 auto;">
    <div class="page-header">
        <div class="header-content" style="display: flex; align-items: center; gap: 1rem;">
            <a href="/admin/contacts" class="btn-icon"
                style="background: var(--white); border: 1px solid var(--brand-border); width: 44px; height: 44px;">
                <i data-lucide="arrow-left"></i>
            </a>
            <h3 style="margin: 0;">
                <%= contact.id ? 'Edit Contact' : 'Add New Contact' %>
            </h3>
        </div>
    </div>

    <div class="card">
        <form action="<%= contact.id ? '/admin/contacts/' + contact.id + '?_method=PUT' : '/admin/contacts' %>"
            method="POST">
            <div class="form-row">
                <div class="form-group">
                    <label for="type">Method Type</label>
                    <div class="input-with-icon">
                        <i data-lucide="layers"></i>
                        <select id="type" name="type" class="form-control" required>
                            <option value="email" <%=contact.type==='email' ? 'selected' : '' %>>Email</option>
                            <option value="phone" <%=contact.type==='phone' ? 'selected' : '' %>>Phone</option>
                            <option value="location" <%=contact.type==='location' ? 'selected' : '' %>>Location</option>
                            <option value="other" <%=contact.type==='other' ? 'selected' : '' %>>Other</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="label">Display Label</label>
                    <div class="input-with-icon">
                        <i data-lucide="tag"></i>
                        <input type="text" id="label" name="label" class="form-control"
                            value="<%= contact.label || '' %>" required placeholder="e.g. Work Email">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="value">Visible Text (Value)</label>
                <div class="input-with-icon">
                    <i data-lucide="type"></i>
                    <input type="text" id="value" name="value" class="form-control" value="<%= contact.value || '' %>"
                        required placeholder="e.g. john@example.com">
                </div>
            </div>

            <div class="form-group">
                <label for="link">Click Action (HREF Link)</label>
                <div class="input-with-icon">
                    <i data-lucide="link"></i>
                    <input type="text" id="link" name="link" class="form-control" value="<%= contact.link || '' %>"
                        placeholder="e.g. mailto:john@example.com">
                </div>
                <small style="color: var(--brand-muted); display: block; margin-top: 0.5rem; font-size: 0.75rem;">
                    Use mailto: for emails, tel: for phones, or a full URL for web links.
                </small>
            </div>

            <div class="form-group" style="position: relative;">
                <label for="icon">Icon (Search Lucide)</label>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div class="input-with-icon" style="flex-grow: 1;">
                        <i data-lucide="search"></i>
                        <input type="text" id="icon-search" name="icon" class="form-control"
                            value="<%= contact.icon || 'Mail' %>" autocomplete="off" placeholder="Search icons...">
                        <div id="icon-dropdown" class="icon-dropdown" style="display: none;">
                            <div id="icon-list" class="icon-list"
                                style="grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));"></div>
                        </div>
                    </div>
                    <div id="icon-preview-main" class="item-icon" style="width: 50px; height: 50px;">
                        <i data-lucide="<%= contact.icon?.toLowerCase() || 'mail' %>"></i>
                    </div>
                </div>
            </div>

            <div class="form-actions"
                style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--brand-border);">
                <a href="/admin/contacts" class="btn" style="background: var(--brand-offwhite);">Cancel</a>
                <button type="submit" class="btn btn-primary" style="min-width: 180px;">
                    <%= contact.id ? 'Save Changes' : 'Create Contact' %>
                </button>
            </div>
        </form>
    </div>
</div>

<script src="https://unpkg.com/lucide@latest"></script>
<script>
    lucide.createIcons();

    const iconSearch = document.getElementById('icon-search');
    const iconDropdown = document.getElementById('icon-dropdown');
    const iconList = document.getElementById('icon-list');
    const mainPreview = document.getElementById('icon-preview-main');

    const commonIcons = [
        'Mail', 'Phone', 'MapPin', 'Globe', 'Github', 'Linkedin', 'Twitter', 'Instagram',
        'MessageSquare', 'Send', 'Smartphone', 'Cpu', 'Briefcase', 'GraduationCap', 'Fingerprint'
    ];

    function updatePreview(iconName) {
        mainPreview.innerHTML = `<i data-lucide="${iconName.toLowerCase()}"></i>`;
        lucide.createIcons();
    }

    iconSearch.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase();
        if (query.length < 1) {
            iconDropdown.style.display = 'none';
            return;
        }
        const filtered = commonIcons.filter(icon => icon.toLowerCase().includes(query));
        if (filtered.length > 0) {
            iconList.innerHTML = filtered.map(icon => `
                <div class="icon-option" onclick="selectIcon('${icon}')">
                    <i data-lucide="${icon.toLowerCase()}"></i>
                    <span>${icon}</span>
                </div>
            `).join('');
            iconDropdown.style.display = 'block';
            lucide.createIcons();
        } else {
            iconDropdown.style.display = 'none';
        }
        updatePreview(e.target.value || 'mail');
    });

    window.selectIcon = function (icon) {
        iconSearch.value = icon;
        iconDropdown.style.display = 'none';
        updatePreview(icon);
    }

    document.addEventListener('click', (e) => {
        if (!iconSearch.contains(e.target) && !iconDropdown.contains(e.target)) {
            iconDropdown.style.display = 'none';
        }
    });
</script>