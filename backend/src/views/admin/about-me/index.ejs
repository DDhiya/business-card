<div class="card">
    <div class="page-header">
        <div class="header-content">
            <h3>About Me Paragraphs</h3>
            <p>Write and arrange the story of your professional background</p>
        </div>
    </div>

    <div class="add-section">
        <form action="/admin/about-me" method="POST">
            <div class="form-group">
                <label>New Paragraph Content</label>
                <textarea name="content" class="form-control" rows="4" required
                    placeholder="Describe your expertise, hobbies, or professional philosophy..."></textarea>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-accent">Add Paragraph</button>
            </div>
        </form>
    </div>

    <div class="section-divider" style="margin: 2.5rem 0; height: 1px; background: var(--brand-border);"></div>

    <div class="list-meta"
        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h4 style="margin: 0; color: var(--brand-primary);">Existing Content</h4>
        <span style="font-size: 0.75rem; color: var(--brand-muted); font-weight: 500;">Drag to reorder sections</span>
    </div>

    <div id="paragraph-list" class="experience-list">
        <% paragraphs.forEach(p=> { %>
            <div class="list-item paragraph-item" data-id="<%= p.id %>" style="cursor: move;">
                <div id="display-<%= p.id %>" class="paragraph-display">
                    <div
                        style="line-height: 1.7; color: var(--brand-text); white-space: pre-wrap; font-size: 0.9375rem;">
                        <%= p.content %>
                    </div>
                    <div class="item-actions" style="margin-top: 1.5rem;">
                        <button type="button" class="btn btn-primary btn-sm"
                            onclick="toggleEdit('<%= p.id %>')">Edit</button>
                        <form action="/admin/about-me/<%= p.id %>?_method=DELETE" method="POST" style="display: inline;"
                            onsubmit="return confirm('Are you sure you want to delete this paragraph?')">
                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                        </form>
                    </div>
                </div>

                <div id="edit-form-<%= p.id %>" style="display: none;">
                    <form action="/admin/about-me/<%= p.id %>?_method=PUT" method="POST">
                        <div class="form-group">
                            <label>Edit Paragraph</label>
                            <textarea name="content" class="form-control" rows="5" required><%= p.content %></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-sm" onclick="toggleEdit('<%= p.id %>')"
                                style="background: var(--brand-offwhite);">Cancel</button>
                            <button type="submit" class="btn btn-primary btn-sm">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
            <% }) %>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
    function toggleEdit(id) {
        const displayDiv = document.getElementById(`display-${id}`);
        const formDiv = document.getElementById(`edit-form-${id}`);

        if (formDiv.style.display === 'none') {
            formDiv.style.display = 'block';
            displayDiv.style.display = 'none';
        } else {
            formDiv.style.display = 'none';
            displayDiv.style.display = 'block';
        }
    }

    const el = document.getElementById('paragraph-list');
    if (el) {
        Sortable.create(el, {
            animation: 150,
            ghostClass: 'sortable-ghost',
            onEnd: function (evt) {
                const order = Array.from(el.querySelectorAll('.list-item')).map(item => item.getAttribute('data-id'));
                fetch('/admin/about-me/reorder', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ order })
                });
            }
        });
    }
</script>